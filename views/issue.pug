extend ./layout.pug
block title
  title="Issue"
block content
  div.back
    if issue.fields.status.name === 'To Do'
      a(href='/todo')='< Back to assignments'
    if issue.fields.status.name === 'In Progress'
      a(href='/inprog')='< Back to assignments'
    if issue.fields.status.name === 'Done'
      a(href='/done')='< Back to assignments'
  div.issuekey=issue.fields.issuetype.name + ': ' + issue.key + ' '
    span.status(class=issue.fields.status.name)=issue.fields.status.name
  h3.issuetitle=issue.fields.summary
  p
    each component in issue.fields.components
      span.component=component.name
  p
    strong='Due date: '
    span=issue.fields.duedate
  p
    strong='Coordinates: '
    span=issue.fields.customfield_10100
  p=issue.fields.description
  p
    strong='Requestor: '
    span=issue.fields.customfield_10025
  p
    strong='Reporter: '
    span=issue.fields.reporter.displayName

  if issue.fields.status.name === 'To Do'
    a.btn(href='/issue/' + issue.key + '/transition/21')='Start'
    span.btn.disabled='Move to Todo'
    span.btn.disabled='Set Done'
  if issue.fields.status.name === 'In Progress'
    span.btn.disabled='Start'
    a.btn(href='/issue/' + issue.key + '/transition/51')='Move to Todo'
    a.btn(href='/issue/' + issue.key + '/transition/41')='Set Done'
  if issue.fields.status.name === 'Done'
    a.btn(href='/issue/' + issue.key + '/transition/71')='Reopen'

  .comments
    h3='Comments'
    each comment in issue.fields.comment.comments
      .comment
        .title=comment.author.displayName + ' | ' + comment.created
        p=comment.body

    .add-comment
      form(action='/issue/' + issue.key + '/comment', method='POST')
        input(type='hidden', name='_csrf', value=csrfToken)
        textarea(name='comment')
        p
          input.btn(type='submit', value='Add comment')
